<style>
span {
  margin-right: 10px;
}
.p0, .p1 {
  display: none;
}
</style>

<span class='x p2'>xx</span><span class='x p1'>x</span>

<script>
X = x => document.querySelector(x);
xx = 'innerText';
n = 40;
n = 4_000;
// n = 4_000_000;
for(;x =
  (x => {
    x.classList.add(
      'x',
      'p'
      +(
        +
        Array.from(X('.x').classList)
          .filter(x=>x!=='x')
          .map(x => x[1])
        +1
      )
      % 3
    );
    x[xx] = X('.x')[xx] + X('.x:not(:first-child)')[xx];
    if (x[xx].length <= n) return x
  })(document.createElement('span'))
;) document.body.prepend(x);
console.log(document.body[xx].length);
</script>
